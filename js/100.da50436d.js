"use strict";(self["webpackChunkwujiuyixiu"]=self["webpackChunkwujiuyixiu"]||[]).push([[100],{8100:function(e,t,l){l.r(t),l.d(t,{default:function(){return k}});var a=l(3396);const o=e=>((0,a.dD)("data-v-0529153a"),e=e(),(0,a.Cn)(),e),r={style:{border:"1px solid #ccc","z-index":"1000"}},i={class:"post-article-setting"},s=o((()=>(0,a._)("h3",null,"发布设置",-1))),n=["src"],u={key:1},d=o((()=>(0,a._)("div",{class:"ant-upload-text"},"封面上传",-1))),p=o((()=>(0,a._)("p",null,"支持上传图片格式：JPEG,PNG,JPG。",-1))),c=(0,a.Uk)("发布");function m(e,t,l,o,m,f){const g=(0,a.up)("a-col"),h=(0,a.up)("Toolbar"),v=(0,a.up)("a-input"),_=(0,a.up)("Editor"),b=(0,a.up)("loading-outlined"),w=(0,a.up)("plus-outlined"),y=(0,a.up)("a-upload"),C=(0,a.up)("a-form-item"),Z=(0,a.up)("a-button"),P=(0,a.up)("a-form"),U=(0,a.up)("a-row");return(0,a.wg)(),(0,a.j4)(U,{class:"post-article"},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{xs:2,sm:2,md:2,lg:2,xl:4}),(0,a.Wm)(g,{xs:20,sm:20,md:20,lg:20,xl:16},{default:(0,a.w5)((()=>[(0,a._)("div",r,[(0,a.Wm)(h,{style:{"border-bottom":"1px solid #ccc"},editor:e.editorRef,defaultConfig:e.toolbarConfig,mode:e.mode},null,8,["editor","defaultConfig","mode"]),(0,a.Wm)(v,{style:{borderTop:"none",borderLeft:"none",borderRight:"none"},value:e.title,"onUpdate:value":t[0]||(t[0]=t=>e.title=t),size:"large",placeholder:"请输入标题"},null,8,["value"]),(0,a.Wm)(_,{class:"post-article-editor",style:{"min-height":"500px","overflow-y":"hidden"},modelValue:e.valueHtml,"onUpdate:modelValue":t[1]||(t[1]=t=>e.valueHtml=t),defaultConfig:e.editorConfig,mode:e.mode,onOnCreated:e.handleCreated},null,8,["modelValue","defaultConfig","mode","onOnCreated"])]),(0,a._)("div",i,[s,(0,a.Wm)(P,{"label-col":{span:2},"wrapper-col":{span:22},autocomplete:"off"},{default:(0,a.w5)((()=>[(0,a.Wm)(C,{label:"封面",name:"username"},{default:(0,a.w5)((()=>[(0,a.Wm)(y,{"file-list":e.fileList,"onUpdate:file-list":t[2]||(t[2]=t=>e.fileList=t),"list-type":"picture-card",class:"avatar-uploader","show-upload-list":!1,"before-upload":e.beforeUpload,customRequest:e.handleUpdateImg,onChange:e.handleChange},{default:(0,a.w5)((()=>[e.imageUrl?((0,a.wg)(),(0,a.iD)("img",{key:0,style:{width:"100%",height:"100%"},src:e.imageUrl,alt:"avatar"},null,8,n)):((0,a.wg)(),(0,a.iD)("div",u,[e.loading?((0,a.wg)(),(0,a.j4)(b,{key:0})):((0,a.wg)(),(0,a.j4)(w,{key:1})),d]))])),_:1},8,["file-list","before-upload","customRequest","onChange"]),p])),_:1}),(0,a.Wm)(C,{label:"标签",name:"password","wrapper-col":{offset:0,span:8}},{default:(0,a.w5)((()=>[(0,a.Wm)(v,{value:e.label,"onUpdate:value":t[3]||(t[3]=t=>e.label=t)},null,8,["value"])])),_:1}),(0,a.Wm)(C,{"wrapper-col":{offset:2,span:16}},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{type:"primary","html-type":"submit",onClick:e.postArticle},{default:(0,a.w5)((()=>[c])),_:1},8,["onClick"])])),_:1})])),_:1})])])),_:1}),(0,a.Wm)(g,{xs:2,sm:2,md:2,lg:2,xl:4})])),_:1})}var f=l(4870),g=l(6126),h=l(2510),v=l(7081),_=l(252),b=l(6158),w=l(6639),y=l(5410),C=l.n(y),Z=l(6265),P=l.n(Z);function U(e,t){const l=new FileReader;l.addEventListener("load",(()=>t(l.result))),l.readAsDataURL(e)}var x=(0,a.aZ)({name:"PostArticle",components:{Editor:g.M,Toolbar:g.o,LoadingOutlined:h.Z,PlusOutlined:v.Z},setup(){const e=(0,f.XI)(),t=(0,f.iH)("");(0,a.bv)((()=>{}));const l={},o={placeholder:"请输入内容...(暂时不支持上传文档图片，视频)",scroll:!1};let r=!1;(0,a.Jd)((()=>{const t=e.value;null!=t&&t.destroy()}));const i=t=>{e.value=t},s=(0,f.iH)(""),n=(0,f.iH)([]),u=(0,f.iH)(!1),d=(0,f.iH)("");let p="";const c=e=>{"uploading"!==e.file.status?("done"===e.file.status&&U(e.file.originFileObj,(e=>{d.value=e,u.value=!1})),"error"===e.file.status&&(u.value=!1,_.ZP.error("upload error"))):u.value=!0},m=e=>{const t="image/jpeg"===e.type||"image/png"===e.type||"image/jpg"===e.type;t||_.ZP.error("你需要上传JPEG,PNG,JPG格式的图片");const l=e.size/1024/1024<2;return l||_.ZP.error("你的图片过大,最大上传2MB!"),t&&l};return{editorRef:e,valueHtml:t,mode:"default",toolbarConfig:l,editorConfig:o,handleCreated:i,title:s,fileList:n,loading:u,imageUrl:d,handleChange:c,beforeUpload:m,GLOBALCONFIG:b.Z,img_url:p,isupdate:r}},data(){return{label:""}},methods:{handleUpdateImg(e){""!=this.imageUrl&&this.deleteImg();const t={"Content-Type":"multipart/form-data"},l=P().create({headers:t});l.post(b.Z.GLOBAL.vue_http_api+"update_cover",e).then((e=>{this.imageUrl=b.Z.GLOBAL.vue_http_api+e.data.data,this.img_url=e.data})).catch((e=>{_.ZP.error("上传图片失败")}))},deleteImg(){w.Z["delete"]("/update_cover?img_name="+this.imageUrl).then((e=>{console.log("图片更新成功")})).catch((e=>{console.log("图片更新删除失败")}))},postArticle(){if(this.isupdate=!0,""==this.$store.state.userData)return void _.ZP.error("需要先登录账号！");if(null==this.isEmpty())return;let e={title:this.title,html:this.valueHtml,text:this.editorRef.getText(),article_user_id:this.$store.state.userData.uid,article_cover:this.imageUrl,is_encryption:"0",article_password:"0",article_collect:"0",like:0,watch_number:0,comment_number:0,classification:this.label,username:this.$store.state.userData.name};w.Z.post("/article",C().stringify(e)).then((e=>{null!=e.data?_.ZP.success("文章上传成功"):_.ZP.error("文章上传失败")})).catch((e=>{_.ZP.error("文章上传失败")}))},isEmpty(){return""==this.title?(_.ZP.error("请输入标题"),null):this.editorRef.getText().length<10?(_.ZP.error("内容不得小于10个字"),null):""==this.imageUrl?(_.ZP.error("请上传封面"),null):1}}}),L=l(89);const W=(0,L.Z)(x,[["render",m],["__scopeId","data-v-0529153a"]]);var k=W}}]);
//# sourceMappingURL=100.da50436d.js.map